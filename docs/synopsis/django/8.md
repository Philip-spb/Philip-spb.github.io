---
layout: default
title: "Связи моделей"
grand_parent: "Конспекты"
parent: "Django"
nav_order: 8
---

# Связи моделей

Если мы хотим связать разные модули (например новости и категории новостей), то нам необходимо сделать следующее:

1. Создать новый класс (например категорий новостей). Делается это в файле `models.py` модуля новостей:

    ```python
    class Category(models.Model):
        title = models.CharField(max_length=150, db_index=True, verbose_name='Наименование категории')

        def __str__(self):	# Добавляем строковое представление объекта
            return self.title

        class Meta:
            verbose_name = 'Категория'  # наименование модели в единственном числе
            verbose_name_plural = 'Категории'  # наименование модели во множественном числе
            ordering = ['title']
    ```

    | Параметр        | Описание                                                    |
    | --------------- | ----------------------------------------------------------- |
    | `db_index=True` | Делаем поле индексируемым, тем самым ускоряем поиск по нему |

2. Далее в классе новостей добавляем новое поле `ForeignKey`:
    ```python
    category = models.ForeignKey('Category', on_delete=models.PROTECT, null=True, verbose_name='Наименование категории')
    ```

    | Параметр                   | Описание                                                                                                                                                                           |
    | -------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
    | `on_delete=models.PROTECT` | Защита от удаления связанных данных                                                                                                                                                |
    | `null=True`                | Данное поле необходимо при предотвращении конфликтов возникающих при добавлении новой обязательной колонки. Все уже добавленные новости будут иметь данное поле со значением null. |

3. Выполняем подготовку миграции и выполняем миграцию

4. Для отображения категорий в админке нужно в файле `admin.py`:

- Импортировать модуль:
```python
from .models import Category
```
- Зарегистрировать модуль
```python
admin.site.register(Category, CategoryAdmin)
```

- Настроить отображения в админке
```python
class CategoryAdmin(admin.ModelAdmin):
    list_display = ('id', 'title')
    list_display_links = ('id', 'title')
    search_fields = ('title',)
```